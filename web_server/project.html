{% extends "base.html" %}

{% block headline %}Project {{project.ID}}{% endblock %}

{% block content %}

<table class="form">
    <tr>    <th>Project ID</th>         <td>{{project.ID}}</td> </tr>
    <tr>    <th>User</th>               <td>{{project.Owner}}</td> </tr>
    <tr>    <th>Created</th>            <td>{{project.CreatedTimestamp}}</td> </tr>

    <tr>    <th>Status</th>             <td>{{project.State}}</td> </tr>
    <tr>    <th>Attributes</th>         <td class="nopadding">
            {% if project.Attributes|length %}
                <table class="placement attributes dense">
                    {% for name, value in project.Attributes.items() %}
                        <tr><td style="text-align: right">{{name}}:</td><td>{{value}}</td></tr>
                    {% endfor %}
                </table>
            {% endif %}
            </td> 
    </tr>
    <tr>    <th>Handles by status</th>
            <td class="nopadding">
                <table class="placement dense">
                    {% for state in states -%}
                        <tr><td>{{state}}</td><td>{{handle_counts_by_state[state]}}
                            {%- if state == "ready" %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;available:{{available_handles}}{% endif %}</td></tr>
                    {% endfor %}
                </table>
            <td>
    </tr>
    <tr>    <th>Handles</th>
            <td>
                <table class="data replicas">
                    <tr><th>File</th><th>Status</th><th>Replicas(available)</th><th>Worker</th><th>Attempts</th>
                    </tr>
                    {% for handle in handles %}
                        <tr>
                            <td><a href="./handle?project_id={{project.ID}}&namespace={{handle.Namespace}}&name={{handle.Name}}">
                                    {{handle.Namespace}}:{{handle.Name}}
                                </a>
                            </td>
                            {% set state = "available" if handle.State == "ready" and handle.is_available() else handle.State %}
                            <td class="{{state}}">{{state}}</td>
                            <td>
                                {{handle.n_replicas}} ({{handle.n_available_replicas}})
                            </td>
                            <td>{{handle.WorkerID or ""}}</td>
                            <td>{{handle.Attempts}}</td>
                        </tr>
                    {% endfor %}
                </table>
            </td>
    </tr>
    <tr>    <th>Processing log</th>
            <td>
                <table class="data">
                    <tr>
                        <th colspan=2>Time</th>
                        <th>Event</th>
                        <th>File</th>
                        <th>Worker</th>
                        <th>Data</th>
                    </tr>
                    {% for l in handle_log %}
                        <tr>
                            <td>{{l.T}}</td>
                            <td>{{project.time_since_created(l.T)|pretty_time_delta}}</td>
                            <td class="{{l.Type}}">{{l.Type}}</td>
                            <td>{{l.Namespace}}:{{l.Name}}</td>
                            <td>{{l.Data.get("worker") or ""}}</td>
                            <td>{% for n, v in l.Data.items() %}
                                    {% if n != "worker" %}
                                        {{n}}: {{v}} {% if not loop.last %}<br/>{% endif %}
                                    {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </td>
    </tr>
</table>

{% endblock %}



