{% extends "base.html" %}

{% block headline %}File Handle{% endblock %}

{% block content %}

<table class="form">
    <tr>    <th>Project ID</th> <td><a href="./project?project_id={{handle.ProjectID}}">{{handle.ProjectID}}</a></td> </tr>
    <tr>    <th>File namespace</th> <td>{{handle.Namespace}}</td></tr>
    <tr>    <th>File name</th> <td>{{handle.Name}}</td></tr>
    <tr>    <th>State</th> <td>{{handle.State}}</td></tr>
    <tr>    <th>Worker</th> <td>{{handle.WorkerID or ""}}</td></tr>
    <tr>    <th>Attempts</th> <td>{{handle.Attempts}}</td></tr>
    <tr>    <th>Attributes</th> 
            <td class="nopadding">
                {% if handle.Attributes|length %}
                    <table class="placement attributes dense">
                        {% for name, value in handle.Attributes.items() %}
                            <tr><td style="text-align: right">{{name}}:</td><td>{{value}}</td></tr>
                        {% endfor %}
                    </table>
                {% endif %}
            </td>
    </tr>
    <tr>    <th>Replicas</th>
            <td class="nopadding">
                <table class="data">
                    <tr><th>RSE</th><th>Preference</th><th>RSE available</th><th>Staged</th><th>Path/URL</th>
                    {% for r in handle.replicas().values() %}
                        <tr>
                            <td>{{r.RSE}}</td>
                            <td>{{r.Preference}}</td>
                            <td class="{{'available' if r.RSEAvailable else 'unavailable'}}">{{"yes" if r.RSEAvailable else "no"}}</td>
                            <td class="{{'available' if r.Available else 'unavailable'}}">{{"yes" if r.Available else "no"}}</td>
                            <td>path:&nbsp;{{r.Path}}<br/>URL:&nbsp;{{r.URL}}</td>
                        </tr>
                    {% endfor %}
                </table>
        </td> 
    </tr>
    {% if handle_log is not none and handle_log|length %}
    <tr>    <th>Handle log</th>
            <td class="nopadding">
                <table class="data">
                    <tr><th>Time</th><th>Event</th><th>Data</th></tr>
                    {% for log_record in handle_log %}
                        <tr>
                            <td>{{log_record.T|as_dt_utc}}</td>
                            <td class="{{log_record.Type}}">{{log_record.Type}}</td>
                            <td>{% for n, v in log_record.Data.items() %}
                                    {{n}} = {{v}}{% if not loop.last %}<br/>{% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            </td>
    </tr>
    {% endif %}
</table>

{% endblock %}



